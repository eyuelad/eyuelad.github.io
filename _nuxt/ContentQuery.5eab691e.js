import{k as S,r as C,l as P,m as j,p as O,w as x,u as B,q as M,f as N,t as $,s as z,h as A,j as E}from"./entry.c157c8c3.js";import{h as Q,q as k}from"./query.706b208b.js";const H=()=>null;function R(...u){var p,r,f,q,w,g,D;const n=typeof u[u.length-1]=="string"?u.pop():void 0;typeof u[0]!="string"&&u.unshift(n);let[e,l,t={}]=u;if(typeof e!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof l!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");t.server=(p=t.server)!=null?p:!0,t.default=(r=t.default)!=null?r:H,t.lazy=(f=t.lazy)!=null?f:!1,t.immediate=(q=t.immediate)!=null?q:!0;const a=S(),d=()=>a.isHydrating?a.payload.data[e]:a.static.data[e],c=()=>d()!==void 0;a._asyncData[e]||(a._asyncData[e]={data:C((D=(g=d())!=null?g:(w=t.default)==null?void 0:w.call(t))!=null?D:null),pending:C(!c()),error:C(a.payload._errors[e]?P(a.payload._errors[e]):null)});const i={...a._asyncData[e]};i.refresh=i.execute=(o={})=>{if(a._asyncDataPromises[e]){if(o.dedupe===!1)return a._asyncDataPromises[e];a._asyncDataPromises[e].cancelled=!0}if(o._initial&&c())return d();i.pending.value=!0;const v=new Promise((s,m)=>{try{s(l(a))}catch(b){m(b)}}).then(s=>{if(v.cancelled)return a._asyncDataPromises[e];t.transform&&(s=t.transform(s)),t.pick&&(s=T(s,t.pick)),i.data.value=s,i.error.value=null}).catch(s=>{var m,b;if(v.cancelled)return a._asyncDataPromises[e];i.error.value=s,i.data.value=B((b=(m=t.default)==null?void 0:m.call(t))!=null?b:null)}).finally(()=>{v.cancelled||(i.pending.value=!1,a.payload.data[e]=i.data.value,i.error.value&&(a.payload._errors[e]=P(i.error.value)),delete a._asyncDataPromises[e])});return a._asyncDataPromises[e]=v,a._asyncDataPromises[e]};const y=()=>i.refresh({_initial:!0}),_=t.server!==!1&&a.payload.serverRendered;{const o=M();if(o&&!o._nuxtOnBeforeMountCbs){o._nuxtOnBeforeMountCbs=[];const s=o._nuxtOnBeforeMountCbs;o&&(j(()=>{s.forEach(m=>{m()}),s.splice(0,s.length)}),O(()=>s.splice(0,s.length)))}_&&a.isHydrating&&c()?i.pending.value=!1:o&&(a.payload.serverRendered&&a.isHydrating||t.lazy)&&t.immediate?o._nuxtOnBeforeMountCbs.push(y):t.immediate&&y(),t.watch&&x(t.watch,()=>i.refresh());const v=a.hook("app:data:refresh",s=>{if(!s||s.includes(e))return i.refresh()});o&&O(v)}const h=Promise.resolve(a._asyncDataPromises[e]).then(()=>i);return Object.assign(h,i),h}function T(u,n){const e={};for(const l of n)e[l]=u[l];return e}const F=N({name:"ContentQuery",props:{path:{type:String,required:!1,default:void 0},only:{type:Array,required:!1,default:void 0},without:{type:Array,required:!1,default:void 0},where:{type:Object,required:!1,default:void 0},sort:{type:Object,required:!1,default:void 0},limit:{type:Number,required:!1,default:void 0},skip:{type:Number,required:!1,default:void 0},locale:{type:String,required:!1,default:void 0},find:{type:String,required:!1,default:void 0}},async setup(u){const{path:n,only:e,without:l,where:t,sort:a,limit:d,skip:c,locale:i,find:y}=$(u),_=z(()=>{var r;return(r=n.value)==null?void 0:r.includes("/_")});x(()=>u,()=>p(),{deep:!0});const{data:h,refresh:p}=await R(`content-query-${Q(u)}`,()=>{let r;return n.value?r=k(n.value):r=k(),e.value&&(r=r.only(e.value)),l.value&&(r=r.without(l.value)),t.value&&(r=r.where(t.value)),a.value&&(r=r.sort(a.value)),d.value&&(r=r.limit(d.value)),c.value&&(r=r.skip(c.value)),i.value&&(r=r.where({_locale:i.value})),y.value==="one"?r.findOne():y.value==="surround"?n.value?r.findSurround(n.value):(console.warn("[Content] Surround queries requires `path` prop to be set."),console.warn("[Content] Query without `path` will return regular `find()` results."),r.find()):r.find()});return{isPartial:_,data:h,refresh:p}},render(u){var w;const n=A(),{data:e,refresh:l,isPartial:t,path:a,only:d,without:c,where:i,sort:y,limit:_,skip:h,locale:p,find:r}=u,f={path:a,only:d,without:c,where:i,sort:y,limit:_,skip:h,locale:p,find:r};if(f.find==="one"){if(!e&&(n==null?void 0:n["not-found"]))return n["not-found"]({props:f,...this.$attrs});if((n==null?void 0:n.empty)&&(e==null?void 0:e._type)==="markdown"&&!((w=e==null?void 0:e.body)!=null&&w.children.length))return n.empty({props:f,...this.$attrs})}else if((!e||!e.length)&&n!=null&&n["not-found"])return n["not-found"]({props:f,...this.$attrs});return n!=null&&n.default?n.default({data:e,refresh:l,isPartial:t,props:f,...this.$attrs}):((g,D)=>E("pre",null,JSON.stringify({message:"You should use slots with <ContentQuery>!",slot:g,data:D},null,2)))("default",{data:e,props:f,isPartial:t})}}),K=Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"}));export{K as C,F as _,R as u};
